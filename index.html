<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Таблица умножения</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
      .vertical-center {
        min-height: 100%;  /* Fallback for browsers do NOT support vh unit */
        min-height: 100vh; /* These two lines are counted as one :-)       */

        display: flex;
        align-items: center;
      }
      #result {
        display: block;
        line-height: 50px;
      }
      .alert-area, .alert-areaDiv {
        margin-top: 10px;
        width: 250px;
      }
      .tab-content {
        margin-top: 12px;
      }
      #answerStatDiv {
        width: 250px;
        display: block;
      }
      span.right {
        color: green;
      }
      span.wrong {
        color: red;
      }
      .tableLabelLeft {
        margin-right: 12px;
        position: relative;
        top: -2px;
      }
    </style>
  </head>
  <body>
    <div class="col-md-4 col-md-offset-4 vertical-center">
      <div class="container">
        <div>
          <!-- Nav tabs -->
          <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Умножение</a></li>
            <li role="presentation"><a href="#division" aria-controls="division" role="tab" data-toggle="tab">Деление</a></li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="home">
              <!-- Tab 1 Multiplication -->
              <blockquote><p class="grey">Задание: дать 2 правильных ответа подряд на каждый пример.</p></blockquote>
              <div id="answerStat">
                <table class="table table-bordered table-condensed">
                  <tr>
                    <td></td>
                    <td class="active" align="center"><p>2</p><input id="m_cb_x2" type="checkbox" value="" checked="checked"></td>
                    <td class="active" align="center"><p>3</p><input id="m_cb_x3" type="checkbox" value="" checked="checked"></td>
                    <td class="active" align="center"><p>5</p><input id="m_cb_x5" type="checkbox" value="" checked="checked"></td>
                    <td class="active" align="center"><p>4</p><input id="m_cb_x4" type="checkbox" value="" checked="checked"></td>
                    <td class="active" align="center"><p>6</p><input id="m_cb_x6" type="checkbox" value="" checked="checked"></td>
                    <td class="active" align="center"><p>7</p><input id="m_cb_x7" type="checkbox" value="" checked="checked"></td>
                    <td class="active" align="center"><p>8</p><input id="m_cb_x8" type="checkbox" value="" checked="checked"></td>
                    <td class="active" align="center"><p>9</p><input id="m_cb_x9" type="checkbox" value="" checked="checked"></td>
                  </tr>
                  <tr>
                    <td class="active" align="center"><span class="tableLabelLeft">2</span><input id="m_cb_2x" type="checkbox" value="" checked="checked"></td>
                    <td id="m_cell_22"></td><td id="m_cell_23"></td><td id="m_cell_24"></td><td id="m_cell_25"></td><td id="m_cell_26"></td><td id="m_cell_27"></td><td id="m_cell_28"></td><td id="m_cell_29"></td>
                  </tr>
                  <tr>
                    <td class="active" align="center"><span class="tableLabelLeft">3</span><input id="m_cb_3x" type="checkbox" value="" checked="checked"></td>
                    <td id="m_cell_32"></td><td id="m_cell_33"></td><td id="m_cell_34"></td><td id="m_cell_35"></td><td id="m_cell_36"></td><td id="m_cell_37"></td><td id="m_cell_38"></td><td id="m_cell_39"></td>
                  </tr>
                  <tr>
                    <td class="active" align="center"><span class="tableLabelLeft">4</span><input id="m_cb_4x" type="checkbox" value="" checked="checked"></td>
                    <td id="m_cell_42"></td><td id="m_cell_43"></td><td id="m_cell_44"></td><td id="m_cell_45"></td><td id="m_cell_46"></td><td id="m_cell_47"></td><td id="m_cell_48"></td><td id="m_cell_49"></td>
                  </tr>
                  <tr>
                    <td class="active" align="center"><span class="tableLabelLeft">5</span><input id="m_cb_5x" type="checkbox" value="" checked="checked"></td>
                    <td id="m_cell_52"></td><td id="m_cell_53"></td><td id="m_cell_54"></td><td id="m_cell_55"></td><td id="m_cell_56"></td><td id="m_cell_57"></td><td id="m_cell_58"></td><td id="m_cell_59"></td>
                  </tr>
                  <tr>
                    <td class="active" align="center"><span class="tableLabelLeft">6</span><input id="m_cb_6x" type="checkbox" value="" checked="checked"></td>
                    <td id="m_cell_62"></td><td id="m_cell_63"></td><td id="m_cell_64"></td><td id="m_cell_65"></td><td id="m_cell_66"></td><td id="m_cell_67"></td><td id="m_cell_68"></td><td id="m_cell_69"></td>
                  </tr>
                  <tr>
                    <td class="active" align="center"><span class="tableLabelLeft">7</span><input id="m_cb_7x" type="checkbox" value="" checked="checked"></td>
                    <td id="m_cell_72"></td><td id="m_cell_73"></td><td id="m_cell_74"></td><td id="m_cell_75"></td><td id="m_cell_76"></td><td id="m_cell_77"></td><td id="m_cell_78"></td><td id="m_cell_79"></td>
                  </tr>
                  <tr>
                    <td class="active" align="center"><span class="tableLabelLeft">8</span><input id="m_cb_8x" type="checkbox" value="" checked="checked"></td>
                    <td id="m_cell_82"></td><td id="m_cell_83"></td><td id="m_cell_84"></td><td id="m_cell_85"></td><td id="m_cell_86"></td><td id="m_cell_87"></td><td id="m_cell_88"></td><td id="m_cell_89"></td>
                  </tr>
                  <tr>
                    <td class="active" align="center"><span class="tableLabelLeft">9</span><input id="m_cb_9x" type="checkbox" value="" checked="checked"></td>
                    <td id="m_cell_92"></td><td id="m_cell_93"></td><td id="m_cell_94"></td><td id="m_cell_95"></td><td id="m_cell_96"></td><td id="m_cell_97"></td><td id="m_cell_98"></td><td id="m_cell_99"></td>
                  </tr>
                </table>
              </div>
              <form class="form-inline" id="inputForm">
                <div class="form-group">
                  <div class="input-group">
                    <div class="input-group-addon"><span id="task"></span></div>
                    <input type="text" class="form-control" id="answer" autocomplete="off" placeholder="Ответ">
                  </div>
                </div>
              </form>
              <div style="height: 30px;" class="alert-area"></div>
              <div style="height: 30px;" class="alert-area2"></div>
            </div>
            <div role="tabpanel" class="tab-pane" id="division">
              <!-- Tab 2 Division -->
              <h4><span id="answerStatDiv"></span></h4>
              <form class="form-inline" id="inputFormDiv">
                <div class="form-group">
                  <div class="input-group">
                    <div class="input-group-addon"><span id="taskDiv"></span></div>
                    <input type="text" class="form-control" id="answerDiv" autocomplete="off" placeholder="Ответ">
                  </div>
                </div>
              </form>
              <div style="height: 30px;" class="alert-areaDiv"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    
    <script>
      var Pyth = function() {
        var form;
        var multiplier1, multiplier2;
        var picker;
        var alertCleanTimer;

        var onFormSubmit = function() {
          checkAnswer();
          return false;
        };
        var nextTask = function() {
          n = picker.nextNumbers();
          if (n === null) {
            alertComplete();
          } else {
            giveTask(n[0], n[1]);
          }
        }
        var giveTask = function(m1, m2) {
            $('#task').html(m1+' &times; '+m2+' =');
            multiplier1 = m1;
            multiplier2 = m2; 
            $('#answer').val('').focus();
        };
        var checkAnswer = function() {
          var a = $('#answer').val();
          if (a == '') {
            return;
          }
          a = parseInt(a);
          if (isNaN(a)) {
            return;
          }
          $('#answer').blur();
          $('#answer').val('');
          if (a == multiplier1 * multiplier2) {
            alertRight(multiplier1, multiplier2, a);
            picker.logAnswer(multiplier1, multiplier2, true);
          } else {
            alertWrong(multiplier1, multiplier2, a);
            picker.logAnswer(multiplier1, multiplier2, false);
          }
          nextTask();
        };
        var cleanAlerts = function() {
            $('.alert-area').html('');
            if (alertCleanTimer) {
              clearTimeout(alertCleanTimer);
              alertCleanTimer = null;
            }
        }
        var alertComplete = function() {
          cleanAlerts();
          $('.alert-area2').append('<div class="alert alert-success"><strong>Вы выполнили задание!</strong></div>');
          $('#task').html('');
          $('#answer').prop('disabled', true);
          runAlertCleanTimer();
        };
        var alertRight = function(m1,m2,a) {
          cleanAlerts();
          $('.alert-area').append('<div class="alert alert-success"><strong>Верно!</strong> '+m1+'&times;'+m2+'='+a+'</div>');
          $('#m_cell_'+m1+m2).append('<span class="right">&bull;<span>');
          runAlertCleanTimer();
        };
        var alertWrong = function(m1,m2,a) {
          cleanAlerts();
          $('.alert-area').append('<div class="alert alert-danger"><strong>'+a+' это не верно!</strong> '+m1+'&times;'+m2+'='+(m1*m2)+'</div>');
          $('#m_cell_'+m1+m2).append('<span class="wrong">&bull;<span>');
          runAlertCleanTimer();
        };
        var runAlertCleanTimer = function() {
          alertCleanTimer = setTimeout(cleanAlerts, 5000);
        }

        return {
          'init': function(p) {
            picker = p;
            $('#inputForm').submit(onFormSubmit);
            nextTask();
          }
        };
      };

      var Picker = function() {
        var table = {};
        var i,j;
        var initialCell = {
          rights: 0,
          wrongs: 0,
          rightsInRow: 0,
          wrongsInRow: 0,
          lastAnswerIsRight: null
        };

        for (i=1; i<=10; i++) {
          table[i] = {};
          for (j=1; j<=10; j++) {
            table[i][j] = JSON.parse(JSON.stringify(initialCell));
          }
        }

        var pickRandom = function() {
            var m1 = 2 + Math.floor(Math.random() * 7);
            var m2 = 2 + Math.floor(Math.random() * 7);
            return [m1, m2];
        };

        var pickNumbersByCondition = function(condition) {
            var n=0;
            var row = [];

            for (i=2; i<=9; i++) {
              if (! $('#m_cb_'+i+'x').is(':checked')) continue;
              for (j=2; j<=9; j++) {
                if (! $('#m_cb_x'+j).is(':checked')) continue;
                if (condition(table[i][j])) {
                  row[n++] = [i,j];
                }
              }
            }

            if (row.length == 0) {
              return null;
            }

            return row[Math.floor(Math.random() * n)];
        };

        var cond1 = function(cell) {
          if (cell.rightsInRow >= 2) {
            return false;
          }

          return true;
        };

        return {
          'nextNumbers': function() {
            return pickNumbersByCondition(cond1);
          },
          'logAnswer': function (m1, m2, isRight) {
            if (isRight) {
              table[m1][m2].rights ++;
              if (table[m1][m2].lastAnswerIsRight === true) {
                table[m1][m2].rightsInRow ++;
              } else {
                table[m1][m2].rightsInRow = 1;
              }
              table[m1][m2].wrongsInRow = 0;
              table[m1][m2].lastAnswerIsRight = true;
            } else {
              table[m1][m2].wrongs ++;
              if (table[m1][m2].lastAnswerIsRight === false) {
                table[m1][m2].wrongsInRow ++;
              } else {
                table[m1][m2].wrongsInRow = 1;
              }
              table[m1][m2].rightsInRow = 0;
              table[m1][m2].lastAnswerIsRight = false;
            }
          }
        }
      }

      $(document).ready(function () {
        var checkbox = $('#answerStat').find(':checkbox'), checkboxCookieName = 'checkbox-state';

        checkbox.each(function () {
          var state = Cookies.get(checkboxCookieName + '|' + $(this).attr('id'))
          if (state === 'true') {
            $(this).prop('checked', true);
          } else if (state === 'false') {
            $(this).prop('checked', false);
          }
        });

        checkbox.click(function () {
          Cookies.set(checkboxCookieName + '|' + $(this).attr('id'), $(this).prop('checked'));
        });

        var pyth = new Pyth();
        pyth.init(new Picker());
      });

    </script>
    <script>
      var PythDiv = function() {
        var form;
        var multiplier1, multiplier2;
        var picker;
        var alertCleanTimer;

        var onFormSubmit = function() {
          checkAnswer();
          return false;
        };
        var nextTask = function() {
          n = picker.nextNumbers();
          giveTask(n[0], n[1]);
        }
        var giveTask = function(m1, m2) {
            $('#taskDiv').html((m1*m2)+' &divide; '+m1+' =');
            multiplier1 = m1;
            multiplier2 = m2; 
            $('#answerDiv').val('').focus();
        };
        var checkAnswer = function() {
          var a = $('#answerDiv').val();
          if (a == '') {
            return;
          }
          a = parseInt(a);
          if (isNaN(a)) {
            return;
          }
          $('#answerDiv').blur();
          $('#answerDiv').val('');
          if (a == multiplier2) {
            alertRight(multiplier1, multiplier2, a);
            picker.logAnswer(multiplier1, multiplier2, true);
          } else {
            alertWrong(multiplier1, multiplier2, a);
            picker.logAnswer(multiplier1, multiplier2, false);
          }
          nextTask();
        };
        var cleanAlerts = function() {
            $('.alert-areaDiv').html('');
            if (alertCleanTimer) {
              clearTimeout(alertCleanTimer);
              alertCleanTimer = null;
            }
        }
        var alertRight = function(m1,m2,a) {
          cleanAlerts();
          $('.alert-areaDiv').append('<div class="alert alert-success"><strong>Верно!</strong> '+(m1*m2)+'&divide;'+m1+'='+m2+'</div>');
          $('#answerStatDiv').append('<span class="right">&bull;<span>');
          runAlertCleanTimer();
        };
        var alertWrong = function(m1,m2,a) {
          cleanAlerts();
          $('.alert-areaDiv').append('<div class="alert alert-danger"><strong>'+a+' это не верно!</strong> '+(m1*m2)+'&divide;'+m1+'='+m2+'</div>');
          $('#answerStatDiv').append('<span class="wrong">&bull;<span>');
          runAlertCleanTimer();
        };
        var runAlertCleanTimer = function() {
          alertCleanTimer = setTimeout(cleanAlerts, 5000);
        }

        return {
          'init': function(p) {
            picker = p;
            $('#inputFormDiv').submit(onFormSubmit);
            nextTask();
          }
        };
      };

      var PickerDiv = function() {
        var table = {};
        var i,j;
        var initialCell = {
          rights: 0,
          wrongs: 0,
          rightsInRow: 0,
          wrongsInRow: 0,
          lastAnswerIsRight: null
        };

        for (i=1; i<=10; i++) {
          table[i] = {};
          for (j=1; j<=10; j++) {
            table[i][j] = JSON.parse(JSON.stringify(initialCell));
          }
        }

        var pickRandom = function() {
            var m1 = 2 + Math.floor(Math.random() * 7);
            var m2 = 2 + Math.floor(Math.random() * 7);
            return [m1, m2];
        };

        var pickNumbersByCondition = function(condition) {
            var n=0;
            var row = [];

            for (i=2; i<=9; i++) {
              for (j=2; j<=9; j++) {
                if (condition(table[i][j])) {
                  row[n++] = [i,j];
                }
              }
            }

            if (row.length == 0) {
              return pickRandom();
            }

            return row[Math.floor(Math.random() * n)];
        };

        var cond1 = function(cell) {
          if (cell.rightsInRow >= 2) {
            return false;
          }

          return true;
        };

        return {
          'nextNumbers': function() {
            return pickNumbersByCondition(cond1);
          },
          'logAnswer': function (m1, m2, isRight) {
            if (isRight) {
              table[m1][m2].rights ++;
              if (table[m1][m2].lastAnswerIsRight === true) {
                table[m1][m2].rightsInRow ++;
              } else {
                table[m1][m2].rightsInRow = 1;
              }
              table[m1][m2].wrongsInRow = 0;
              table[m1][m2].lastAnswerIsRight = true;
            } else {
              table[m1][m2].wrongs ++;
              if (table[m1][m2].lastAnswerIsRight === false) {
                table[m1][m2].wrongsInRow ++;
              } else {
                table[m1][m2].wrongsInRow = 1;
              }
              table[m1][m2].rightsInRow = 0;
              table[m1][m2].lastAnswerIsRight = false;
            }
          }
        }
      }

      var pythDiv = new PythDiv();
      pythDiv.init(new PickerDiv());
    </script>
  </body>
</html>
